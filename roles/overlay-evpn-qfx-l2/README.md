
#### 'overlay-evpn-qfx-l2' role  
Generate configuration for EVPN/VXLAN for QFX in L2 mode (no rvi)
 - Overlay iBGP configuration
 - VNI/VLAN creation with associated policy options

Template can be found in [roles/overlay-evpn-qfx-l2/templates/main.conf.j2 ](templates/main.conf.j2)

## Variables Needed by this role

```yaml

# Global parameters
build_dir:            # Repository used save config generated by this role

# Per device parameters
loopback_ip:          # Loopback ip in the defaul VRF, used as VTEP address

overlay:
## Provided by user
    local:
        asn:              # ASN to use for iBGP
    neighbors:            # iBGP neighbors, usually spines loopback addresses
    tenants:              # List of tenants with VLAN per tenants
      <tenant_A_name>:
        id: xx
        bridge_domains:
        - vlan_id:
          vni_id:
        - vlan_id:
          vni_id:
      <tenant_B_name>:
        id: yy
        bridge_domains:
        - vlan_id:
          vni_id:
        - vlan_id:
          vni_id:

## Default parameters
## All default parameters are available [here](defaults/main.yaml)
    vlan_normalized:          # Defined if the VLAN ID must be define when creating a VLAN or not
    bfd:
      min_interval:
      multiplier:
      mode:

## Optional
      remote_gw: [ ip, ip ]   # Recommended for Multi-pod environment to discard loopback from spine that are not local
```


### Example

This template have been designed to used a variable structure mainly composed of hash/dict.  
Leveraging Ansible option to *merge hash*, it become possible to have all required information coming from different variable files, in order to reduce data duplication.

- group_vars/*group_name*/overlay.yaml   > Information shared across devices
- host_vars/*device_name*/overlay.yaml   > information specific to single device

**For Group 'all'**
```yaml
# group_vars/all/overlay.yaml
overlay:
    tenants:
      tenant10:
        id: 10
        bridge_domains:
        - vlan_id: 100
          vni_id: 1000
        - vlan_id: 101
          vni_id: 1001
      tenant20:
        id: 20
        bridge_domains:
        - vlan_id: 105
          vni_id: 1005
        - vlan_id: 106
          vni_id: 1006
```

**For Group 'pod1'**
```yaml
# group_vars/pod1/overlay.yaml
overlay:
    local:
        asn: 65200
    neighbors: [ 100.0.0.11, 100.0.0.12 ]   ## Spines IP for pod 1
    remote_gw: [ 100.0.0.13, 100.0.0.14 ]   ## Spines IP for pod 2
```

## How to Enable Merge Hash in Ansible

In the root directory of your project, create a file name ```ansible.cfg``` and add :
```
[defaults]
hash_behaviour=merge
```
